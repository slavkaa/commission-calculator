<?php
declare(strict_types=1);

namespace App\AfterRefactoring\Infrastructure\Cache;

use Psr\Log\LoggerInterface;

/**
 * Can be replaced with real cache system like Redis, Memcached, etc.
 */
class StaticCache implements StaticCacheInterface
{
    public function __construct(
        protected LoggerInterface $logger
    )
    {}
    
    /** @phpstan-ignore-next-line */
    protected array $cache = [
        // BinListApi have very low limitations and often returns 429 status code
        // So we need to cache the results.
        'BinListApiResponse.45717360' => 'DK',
        'BinListApiResponse.516793' => 'LT',
        'BinListApiResponse.45417360' => 'JP',
        'BinListApiResponse.41417360' => 'JP',
        'BinListApiResponse.4745030' => 'LT',
        
        // Free ExchangeRatesApi key has a limit of 250 requests per month.
        // So we need to cache the results.
        'ExchangeRatesApiResponse' => [
            'success' => true,
            'timestamp' => 1721595004,
            'base' => 'EUR',
            'date' => '2024-07-17',
            'rates' => [
                'AED' => 3.998816,
                'AFN' => 76.908352,
                'ALL' => 100.258743,
                'AMD' => 422.126293,
                'ANG' => 1.960793,
                'AOA' => 950.039494,
                'ARS' => 1006.707782,
                'AUD' => 1.627114,
                'AWG' => 1.959664,
                'AZN' => 1.85091,
                'BAM' => 1.954996,
                'BBD' => 2.196696,
                'BDT' => 127.837394,
                'BGN' => 1.958172,
                'BHD' => 0.410031,
                'BIF' => 3133.610508,
                'BMD' => 1.088702,
                'BND' => 1.463498,
                'BOB' => 7.517906,
                'BRL' => 6.097275,
                'BSD' => 1.087952,
                'BTC' => 1.6051637E-5,
                'BTN' => 91.020945,
                'BWP' => 14.732937,
                'BYN' => 3.560535,
                'BYR' => 21338.559103,
                'BZD' => 2.192998,
                'CAD' => 1.4934,
                'CDF' => 3081.026398,
                'CHF' => 0.966757,
                'CLF' => 0.037157,
                'CLP' => 1025.28809,
                'CNY' => 7.914735,
                'CNH' => 7.931766,
                'COP' => 4405.187249,
                'CRC' => 570.865087,
                'CUC' => 1.088702,
                'CUP' => 28.850603,
                'CVE' => 110.219644,
                'CZK' => 25.251896,
                'DJF' => 193.710287,
                'DKK' => 7.460722,
                'DOP' => 64.413494,
                'DZD' => 146.448736,
                'EGP' => 52.524745,
                'ERN' => 16.33053,
                'ETB' => 62.368535,
                'EUR' => 1,
                'FJD' => 2.434007,
                'FKP' => 0.838911,
                'GBP' => 0.842633,
                'GEL' => 2.955875,
                'GGP' => 0.838911,
                'GHS' => 16.787092,
                'GIP' => 0.838911,
                'GMD' => 73.81852,
                'GNF' => 9365.146207,
                'GTQ' => 8.453521,
                'GYD' => 227.616335,
                'HKD' => 8.502975,
                'HNL' => 26.945912,
                'HRK' => 7.520699,
                'HTG' => 143.610904,
                'HUF' => 390.675274,
                'IDR' => 17651.179881,
                'ILS' => 3.968444,
                'IMP' => 0.838911,
                'INR' => 91.156855,
                'IQD' => 1425.213519,
                'IRR' => 45826.193816,
                'ISK' => 149.772818,
                'JEP' => 0.838911,
                'JMD' => 170.020036,
                'JOD' => 0.771558,
                'JPY' => 171.312681,
                'KES' => 139.802471,
                'KGS' => 92.150673,
                'KHR' => 4470.160512,
                'KMF' => 492.909325,
                'KPW' => 979.832177,
                'KRW' => 1513.074994,
                'KWD' => 0.332946,
                'KYD' => 0.906627,
                'KZT' => 518.346698,
                'LAK' => 24126.072031,
                'LBP' => 97428.407845,
                'LKR' => 330.314075,
                'LRD' => 212.322628,
                'LSL' => 19.955788,
                'LTL' => 3.214654,
                'LVL' => 0.658545,
                'LYD' => 5.246841,
                'MAD' => 10.720289,
                'MDL' => 19.257076,
                'MGA' => 4900.983227,
                'MKD' => 61.584658,
                'MMK' => 3536.061612,
                'MNT' => 3756.02226,
                'MOP' => 8.750999,
                'MRU' => 42.931334,
                'MUR' => 50.809254,
                'MVR' => 16.711879,
                'MWK' => 1886.523688,
                'MXN' => 19.640725,
                'MYR' => 5.103289,
                'MZN' => 69.568048,
                'NAD' => 19.955788,
                'NGN' => 1747.912325,
                'NIO' => 40.043522,
                'NOK' => 11.862029,
                'NPR' => 145.633071,
                'NZD' => 1.811109,
                'OMR' => 0.418758,
                'PAB' => 1.087952,
                'PEN' => 4.073924,
                'PGK' => 4.261246,
                'PHP' => 63.578036,
                'PKR' => 302.566493,
                'PLN' => 4.2853,
                'PYG' => 8226.614717,
                'QAR' => 3.970766,
                'RON' => 4.969533,
                'RSD' => 117.002453,
                'RUB' => 95.717759,
                'RWF' => 1425.513396,
                'SAR' => 4.083568,
                'SBD' => 9.207811,
                'SCR' => 15.363749,
                'SDG' => 637.979526,
                'SEK' => 11.609368,
                'SGD' => 1.464566,
                'SHP' => 0.838911,
                'SLE' => 24.873904,
                'SLL' => 22829.540475,
                'SOS' => 621.74415,
                'SRD' => 32.343176,
                'STD' => 22533.933217,
                'SVC' => 9.520082,
                'SYP' => 2735.396826,
                'SZL' => 19.959786,
                'THB' => 39.543289,
                'TJS' => 11.570639,
                'TMT' => 3.821344,
                'TND' => 3.372912,
                'TOP' => 2.572715,
                'TRY' => 35.984862,
                'TTD' => 7.388959,
                'TWD' => 35.704855,
                'TZS' => 2921.197916,
                'UAH' => 45.141524,
                'UGX' => 4020.345613,
                'USD' => 1.088702,
                'UYU' => 43.841959,
                'UZS' => 13709.358548,
                'VEF' => 3943880.171399,
                'VES' => 39.804029,
                'VND' => 27574.09978,
                'VUV' => 129.252919,
                'WST' => 3.052294,
                'XAF' => 655.687182,
                'XAG' => 0.037261,
                'XAU' => 0.000454,
                'XCD' => 2.942271,
                'XDR' => 0.820662,
                'XOF' => 655.687182,
                'XPF' => 119.331742,
                'YER' => 272.556916,
                'ZAR' => 19.917672,
                'ZMK' => 9799.612612,
                'ZMW' => 27.770572,
                'ZWL' => 350.561598,
            ]
        ]
    ];
    
    public function isHas(string $key): bool
    {
        $this->logger->debug('Search for cached value. Key: ' . $key);
        return isset($this->cache[$key]);
    }
    
    public function get(string $key): mixed
    {
        $this->logger->debug('Cached value used. Value: ' . serialize($this->cache[$key]));
        return $this->cache[$key];
    }
}